// Beta Version 1.2.1 by Simone Luise - infoWishlist@simoneluise.com
// Dev version & documentation: http://github.com/Frogmouth/jQuery.Wishlist

(function(a){window.wishlist={};wishlist.debug=false;if(window.wishlist.debug){if(typeof _=="undefined"){console.log("Undescrore: Not Found!")}else{console.log("Underscore: Ready!")}if(typeof Backbone=="undefined"){console.log("Backbone: Not Found!")}else{console.log("Backbone: Ready!")}}a.fn.wishlist=function(b){var d=this;var c=a.extend({setCookie:{name:d.attr("id"),expire:365,path:"/"},BackboneModel:{defaults:{id:null}},BackboneCollection:{},removeClass:"removeToWish",addClass:"addToWish",triggerClass:"wishAction",clearId:"clearWish",itemType:"div",template:null,triggerEvent:["click","click"],loadOverride:null,removeOverride:null,clearAllWishedItems:null,wishTriggerFunction:null,unbindAll:null,debug:false,text:{noCookies:"Questa funzione Ã¨ utilizzabile solo con cookies attivi.",add:"Aggiungi ",remove:"Rimuovi "}},b);if(typeof window.wishlist[c.setCookie.name]!="undefined"){c.setCookie.name="_"+c.setCookie.name;var e=1}if(c.debug==true){console.log("Inizio Debug");if(typeof e!="undefined"){console.log("Cookie's name already in use: change it please. the name is change in '_yoursetCookie.name'")}}debWish=function(){(c.debug)?console.log("Cookie:",a.cookie(c.setCookie.name)):function(){}};debCookie=function(){(c.debug)?console.log("Collection:",d.wishList):function(){}};toConsole=function(g,f){(c.debug)?console.log(g+": ",f):function(){}};addToWish=function(f){f=(typeof f!="array")?new Array(f):f;d.wishList.add(f);toGlobal();debWish()};removeToWish=function(f){d.wishList.remove(d.wishList.get(f));toGlobal();debWish()};clearWish=function(){d.wishList.remove(d.wishList.models);toGlobal();debWish()};wishToCookie=function(){a.cookie(c.setCookie.name,JSON.stringify(d.wishList),{expires:c.setCookie.expire,path:c.setCookie.path});debCookie()};clearCookies=function(){a.removeCookie(c.setCookie.name,{path:c.setCookie.path});debCookie()};toGlobal=function(){window.wishlist[c.setCookie.name]=d.wishList};addItemList=function(i){var f=c.setCookie.name;var j=c.itemType;var h="";for(key in i){h=(typeof i[key]!="function")?h+"<li class='"+key+"'>"+i[key]+"</li>":h}var g="<"+j+" rel='"+f+"' id='item_"+i.id+"' data-id="+i.id+"><ul>"+h+"</ul></"+j+">";(a("#item_"+i.id).length<1)?d.append(g):a("#item_"+i.id).replaceWith(g)};removeItemList=function(f){if(typeof f=="undefined"){a("*[rel="+c.setCookie.name+"]").fadeOut().remove();return}a("#item_"+f).fadeOut().remove()};picker=function(f){var g=f.data();return g};setHandler=function(){a("."+c.triggerClass).on(c.triggerEvent[0]+".triggerEvent",function(f){f.preventDefault();var g=picker(a(this));toConsole("i data presi",g);if(a(this).hasClass(c.addClass)){addToWish(g);addItemList(g)}else{removeToWish(g.id);removeItemList(g.id)}wishToCookie()});a("#"+c.clearId).on(c.triggerEvent[1]+".triggerClear",function(f){f.preventDefault();clearWish();clearCookies();removeItemList()})};unsetHandler=function(){toConsole("cookie","disattivati! Attivali e riprova.");a("#"+c.clearId,"."+c.triggerClass).on("click",function(){alert(c.text.noCookies)})};a.cookie("wishtest",1,{path:"/"});(a.cookie("wishtest"))?setHandler():unsetHandler();d.cookiesList=a.cookie(c.setCookie.name);d.wishCookie=Backbone.Model.extend(c.BackboneModel);c.BackboneCollection.model=d.wishCookie;d.wishCookies=Backbone.Collection.extend(c.BackboneCollection);window.wishlist[c.setCookie.name]=d.wishList=(!d.cookiesList||d.cookiesList==null)?new d.wishCookies():d.wishList=new d.wishCookies(a.parseJSON(d.cookiesList));debCookie();d.wishList.forEach(function(f){addItemList(f.attributes)});return this}}(jQuery));
